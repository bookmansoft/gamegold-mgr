# 游戏管理功能描述

## 现有CP创建流程

现有的CP创建流程描述如下：

1. 用户登录，访问 游戏管理/添加新游戏 页面，填写 URL地址 和结算钱包地址，其格式举例如下：
    URL： http://h5.gamegold.xin/mock/cp010002
    地址：tb1qhv7h493pmfhthel3nf7rrf7f25deywy9ca7suj
2. 点击验证，系统自动从上述URL地址集采CP信息填入表单
3. 点击提交，系统提交中台，中台首先向全节点提交创建CP请求，再将CP信息插入中台数据库
4. 用户跳转回游戏列表页面，可以看见新创建的CP

注：上述地址中， /mock/cp010002 是系统为实现本地闭环测试而模拟提供的数据集采接口，该接口正常情况下由CP自行提供

上述流程存在的问题有：

1. 结算钱包地址是对系统了解不够透彻导致的错误设定。

正确的做法是留空该地址，系统会自动在操作员自有账户下选取地址，作为CP的注册地址，从而让操作员真实拥有该CP控制权
如果强行提供此地址，则表明操作员将为地址拥有者代为注册CP，操作员如果不真的拥有该地址，将彻底丧失对CP的后续操作权

2. 中台向对等网络提交创建CP请求后，在出块前，该CP信息将不可用，如果出现重整等情况，则中台存储的CP信息将变得不可靠

正确的做法是：
    当操作员登录时，统一向全节点请求自己名下CP列表，和数据库进行比对，必要时更新数据。
    当操作员注册新的CP时，应该等待全节点创建CP成功、下发通知时，再录入CRM数据库，确保数据真实有效

## 调整后的流程(V2.2.0)

1. 用户登录时，系统发起对主网的查询指令，查询并返回该用户名下所有已注册CP信息
2. 系统对返回的CP信息逐条处理，对尚未入库的条目，进行入库处理
3. 系统查询用户名下已经入库的CP信息，对没有进行集采的条目，逐条集采并写入数据库
4. 用户可以注册新的CP条目，注册时需填写CP名称、分类、媒体分成、集采地址等信息。系统收到来自主网的CP注册消息时，先入库，然后自动集采信息并更新到数据库
3. 用户可以选取已注册CP，执行"更新"操作，系统将强制从集采地址上获得信息并更新数据库
