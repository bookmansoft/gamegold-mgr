# 前端环境和后端环境的差异

制作一个前后端兼容的项目，需要考虑很多因素，例如前端页面上 Buffer 对象并不能直接使用，等等。

今天在调测 HMAC256 算法时碰到此类问题，原本的写法:
```js
const crypto = require('crypto')
const hmac = crypto.createHmac('sha256', random);
let sig = hmac.update(token).digest('hex'); //计算并附加访问令牌
```

考虑到前端页面无法使用 Node 库文件 crypto ， 因此引入了第三方包 crypto-js
使用 npm i crypto-js 安装后使用报错，试图使用 bower 安装失败，试图直接引用文件，发现文件来源一般都指向 google-code ... 非常的郁闷

接下来找到了一个前端函数库 create-hmac ， 其内部使用的 Buffer 对象则来自 safe-buffer , 代码如下：
```js
var createHmac = require('create-hmac/browser');  // 加 '/browser' 表示引用其browser版本，否则它会直接调用 Node 的 crypto 库
var hmac = createHmac('sha256', random);          // 传入字符串，函数内部会使用 safe-buffer 进行转化
console.log(hmac.update(token).digest('hex'));    // 加密 token 并转化为字符串，可以指定不同格式如 hex
```

终于通过了测试...
