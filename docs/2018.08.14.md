# gamegold-mgr

## 概述

GamgGold Mgr 是基于 GameGold Core 核心API 的图形化管理工具，并非面向一般公众的开放式网站

GamgGold Mgr 引入 antd design pro 2.1 作为前端框架开发本地管理后台

## 系统部署和运行
1、安装 node 8.0+ ，从node官网下载对应平台安装包，本地安装
2、安装 node-gyp 以支持C++ Addon，详见 https://github.com/nodejs/node-gyp#installation
    1、运行： npm i -g node-gyp
    2、安装 windows-build-tools 以编译本地Node模块。以管理员身份启动PowerShell并运行：
        npm i --global --production windows-build-tools
3、安装 puppeteer 以便进行 Unit Test ， 安装时跳过install.js脚本，避免因无法下载而导致安装失败
    npm i puppeteer@1.9.0 --ignore-scripts
    @note puppeteer 提供直接控制Chrome的api，模拟大部分用户操作来进行 UI Test
    @note 当前应用对 puppeteer 有版本依赖，必须锁定 1.9.0, 否则部分单元测试会报错
    @npm版本指定方式：
        ~会匹配最近的小版本依赖包，比如~1.2.3会匹配所有1.2.x版本，但是不包括1.3.0
        ^会匹配最新的大版本依赖包，比如^1.2.3会匹配所有1.x.x的包，包括1.3.0，但是不包括2.0.0
        直接指定版本号，则会精确匹配
4、在代码中直接指定 chrome.exe 的位置，注意路径使用双反斜杠
```js
    const browser = await puppeteer.launch({ 
        args: ['--no-sandbox'],
        executablePath: 'C:\\Users\\admin\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe'
    });
```
5、运行 npm i 安装依赖库，包括自动调用 node-gyp 安装C++ Addon
6、运行 npm start 启动全节点，并自动打开本地运行的管理后台网站
7、运行 npm run test:all 执行单元测试

## 管理后台功能规划

### V1.0
- 实现用户基本数据统计分析功能
- 支持道具的发行、销毁、空投等功能
- 对存量道具的统计分析功能
- 支持订单管理
- 对道具交易市场的统计分析功能
- 对交易对的统计分析功能

对于存量APP游戏，集成我方提供的SDK，可以和游戏金钱包交互，实现游戏金支付功能。

场景一：游戏玩家安装了钱包并持有游戏金，而游戏集成了和钱包交互的SDK，此时玩家在游戏内和自己的钱包交互，将相应游戏金转入游戏主的地址。
场景二：游戏玩家安装了钱包，在游戏内购买游戏金，此时游戏需自备法币支付接口以收取玩家法币，并集成和钱包交互的SDK，将玩家购买的游戏金转入玩家钱包。
场景三：游戏玩家没有安装钱包，游戏集成了钱包功能，此时游戏为玩家分配默认地址，玩家购买支付都通过该地址进行。如果玩家安装了钱包，则可以在游戏内选择将游戏金从默认地址转入自己的钱包。

### V2.0
1. 提高移动端兼容性，同一套程序，可供 PC/Mobile 同时登录操作
2. 提供大数据分析能力，助力企业主动营销活动

### 区块链浏览器
图形化方式浏览、解读链上数据。这部分功能属于脱敏操作，可以直接或包装后，面向公众无条件开放

### 钱包相关
实现钱包相关的功能，如备份、恢复、转账、浏览钱包内物品，等等。这部分功能需要RPC授权码、钱包插件支持
由于基于PC版的钱包和全节点，无法实现简单易行的密钥管理方案，因此GGM钱包只是从属钱包、经营性钱包
游戏主拥有一个主控钱包，可以向GGM钱包中注入合适的经营资金，由GGM直接执行，也可以应用审批模式，即由GGM生成业务单据，主控钱包审批通过。

### 游戏管理
需要RPC授权码

注册游戏：只能在主控钱包上执行，GGM只提供查询功能
修改游戏信息：只能在主控钱包上执行，GGM只提供查询功能
批量制作道具：在GGM上执行，游戏主预先注入足够的游戏金，GGM批量制作
空投：在GGM上执行。GGM搜索合适的用户群落后，批量发送
挖矿：微调现有挖矿规则，只需要奖励地址上拥有矿产证和足够的游戏金，即可顺利出块，不需要GGM钱包进行签名。

@note 如何为 portal 生成RPC授权码
1、设定配置表 hmac-salt 字段，注意如果该字段被修改，之前发放的所有RPC授权码将全部无效
2、在运行全节点的服务器控制台上，运行如下指令，并将屏显的RPC授权码拷贝、存储，然后离线分发给 portal：
    npm run cli rpc token.auth [cid1, cid2...]
3、在 src/utils/remoting.js 中配置相应参数

## 模块开发范例

1、在 src/pages/List/ 下新增一组文件：
GameList.js
GameList.less

2、在 config/router.config.js / app / routes 中新增一条路径为 'game-list' 的路由
```js
        path: '/list',
        icon: 'table',
        name: 'list',
        routes: [
          {
            path: '/list/game-list',
            name: 'gamelist',
            component: './List/GameList',
          },
        ]
```

3、在 src/locales 下的本地化文件中(例如 zh-CN.js)增加相应条目：
```js
  'menu.list.gamelist': '游戏列表',
```

4、利用 src/utils/remoting.js 提供的 remoting 函数，对接 GameGold Restful 服务

测试阶段利用 mock/gamegold.js 提供测试数据，相关运行指令：
```bash
npm start
```

线上版本利用 config/router.config.js 中的 配置字段 proxy 重定向mock数据
```js
  //配置 webpack-dev-server 的 proxy 属性，代理请求到其他服务器
  proxy: {
    "/api/execute": {
      "target": "http://localhost:17332",
      "changeOrigin": true,
      "pathRewrite": { "^/api/execute" : "" }
    }
  },
```
相关运行指令：
```bash
npm run start:no-mock
```

@note 实测发现 umi 体系中 mock 文件处于优势地位:
1. 使用 npm start 启动系统时，默认mock系统开启，此时 mock 文件中的接口被优先匹配，GET类访问接口也可以同时对接到proxy
2. 使用 npm run start:no-mock 启动系统、禁用mock后，代理配置才能完全生效，包括 POST 类访问接口

5、修改卡片样式，关联各项管理功能
